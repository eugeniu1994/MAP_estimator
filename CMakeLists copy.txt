cmake_minimum_required(VERSION 3.0.2)
project(s_mls)

SET(CMAKE_BUILD_TYPE "Release")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -pthread ")
#this will make the execution fast and compilation slow  
#set( CMAKE_CXX_FLAGS " -O3 " )

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)


#SET(GCC_COVERAGE_LINK_FLAGS "-lstdc++fs")

find_package(catkin REQUIRED COMPONENTS
  geometry_msgs
  nav_msgs
  roscpp
  rosbag
  rospy
  sensor_msgs
  std_msgs
  tf
  gps_common
  eigen_conversions
)

find_package(OpenMP) 
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
add_definitions(-DMP_EN)

#set(PCL_INCLUDE_DIRS "/usr/local/include/pcl-1.8")
#set(PCL_LIBRARY_DIRS "/usr/local/lib")
#set(PCL_DIR "/usr/lib/x86_64-linux-gnu/cmake/pcl")

find_package(PCL REQUIRED)

find_package(Eigen3 REQUIRED)
find_package(Sophus REQUIRED )
find_package(GTSAM REQUIRED)     #if GTSAM is used only
#find_package(OpenCV 3 REQUIRED)  #only for range image 
find_package(PythonLibs REQUIRED)
find_path(MATPLOTLIB_CPP_INCLUDE_DIRS "matplotlibcpp.h") #for plots
find_package(TBB REQUIRED)
find_package(GeographicLib REQUIRED) #required for GNSS stuff

find_package(libLAS REQUIRED) #required to read las files-----------------------------------
message(libLAS_FOUND: ${libLAS_FOUND})
message(STATUS "libLAS_FOUND is set to ${libLAS_FOUND}")

# Manually specify paths for libLAS
set(LIBLAS_INCLUDE_DIRS "/usr/local/include")
set(LIBLAS_LIBRARY_DIRS "/usr/local/lib")
set(LIBLAS_INCLUDE_DIR "/usr/local/include/liblas")
set(LIBLAS_LIBRARY_DIR "/usr/local/lib")
set(LIBLAS_LIBRARIES "las")

# Print debug messages
# message(STATUS "LIBLAS_INCLUDE_DIRS: ${LIBLAS_INCLUDE_DIRS}")
# message(STATUS "LIBLAS_INCLUDE_DIR: ${LIBLAS_INCLUDE_DIR}")
# message(STATUS "LIBLAS_LIBRARY_DIRS: ${LIBLAS_LIBRARY_DIRS}")
# message(STATUS "LIBLAS_LIBRARY: ${LIBLAS_LIBRARY}")
# message(STATUS "LIBLAS_LIBRARIES: ${LIBLAS_LIBRARIES}")
# message(STATUS "LIBLAS_VERSION: ${LIBLAS_VERSION}")
# if(NOT libLAS_FOUND)
#     # Manually specify paths if find_package fails
#     #set(LIBLAS_INCLUDE_DIRS "/usr/local/include")
#     #set(LIBLAS_LIBRARY_DIRS "/usr/local/lib")
#     #set(LIBLAS_LIBRARIES "liblas")
# endif()

include_directories(
  ${catkin_INCLUDE_DIRS}
  ${EIGEN3_INCLUDE_DIR}
  ${PCL_INCLUDE_DIRS}
  ${PYTHON_INCLUDE_DIRS}
  ${Sophus_INCLUDE_DIRS}
  ${GTSAM_INCLUDE_DIR}
  #${OpenCV_INCLUDE_DIRS}
  ${TBB_INCLUDE_DIRS}
  ${LIBLAS_INCLUDE_DIRS}
  include
)

link_directories(
  ${GTSAM_LIBRARY_DIRS}
  #${OpenCV_LIBRARY_DIRS}
  ${LIBLAS_LIBRARY_DIRS}
)

# catkin_package(
#   CATKIN_DEPENDS geometry_msgs nav_msgs roscpp rospy std_msgs 
#   DEPENDS EIGEN3  GTSAM PCL
#   INCLUDE_DIRS  
# )

# add_definitions(-DWITHOUT_NUMPY) #for matplotlib
# #add_definitions(-DSAVE_DATA) #uncomment this to enable saving the data - note it will slow down the execution time

# set(USE_EKF TRUE)
# set(USE_STATIC_KDTREE TRUE) # or FALSE to disable

# add_definitions(-DADAPTIVE_KERNEL=1)
# add_definitions(-DUSE_ALS)

# #------------------------------------------------------------------------


# SET(TARGET_LINK_LIBS ${catkin_LIBRARIES}  ${PYTHON_LIBRARIES} ${Sophus_LIBRARIES} Sophus ${PCL_LIBRARIES}
# ${GCC_COVERAGE_LINK_FLAGS} TBB::tbb ${GeographicLib_LIBRARIES} ${LIBLAS_LIBRARIES} OpenMP::OpenMP_CXX ) 
# SET(MAIN_SOURCE_FILES src/main.cpp src/IMU.cpp src/GNSS.cpp src/utils.cpp src/estimators/Estimator.cpp src/DataHandler.cpp)

# if(USE_STATIC_KDTREE )
#     message("Use the static KDTREE")
#     add_definitions(-DUSE_STATIC_KDTREE=1)
# else()
#     message("Use the iKDTREE")
#     add_definitions(-DUSE_STATIC_KDTREE=0)
#     message(STATUS "Including ikd_Tree.cpp")
#     set(MAIN_SOURCE_FILES ${MAIN_SOURCE_FILES} include/ikd-Tree/ikd_Tree.cpp)
# endif()


# if(USE_EKF)
#     message("Build EKF registration.")
#     add_definitions(-DUSE_EKF=1)
#     #include the RIEKF part
#     set(MAIN_SOURCE_FILES ${MAIN_SOURCE_FILES} src/estimators/RIEKF.cpp)
#     set(MAIN_SOURCE_FILES ${MAIN_SOURCE_FILES} src/estimators/ALS_ekf.cpp)
# else()
#     message("Build ICP registration.")
#     #add the icp estimator
#     if (EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/include/p2p/)
#         add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/include/p2p ${CMAKE_CURRENT_BINARY_DIR}/p2p)
#     endif()
#     set(TARGET_LINK_LIBS ${TARGET_LINK_LIBS} p2p::core)
#     set(TARGET_LINK_LIBS ${TARGET_LINK_LIBS} gtsam)
#     set(MAIN_SOURCE_FILES ${MAIN_SOURCE_FILES} src/estimators/ICP.cpp src/Graph.cpp)
#     set(MAIN_SOURCE_FILES ${MAIN_SOURCE_FILES} src/estimators/ALS_icp.cpp)
    
# endif()

# message(STATUS "MAIN_SOURCE_FILES: ${MAIN_SOURCE_FILES}")
# add_executable(mls_mapping ${MAIN_SOURCE_FILES}) 
# #add_executable(mls_mapping src/test_boost.cpp) 
# target_link_libraries(mls_mapping ${TARGET_LINK_LIBS} ) 
# add_dependencies(mls_mapping ${catkin_EXPORTED_TARGETS})
# target_include_directories(mls_mapping PRIVATE ${PYTHON_INCLUDE_DIRS})










